{"id":"rainlogger-1cw","title":"Sensor failures silently swallowed with no log warning","description":"When read_ds18b20_temp() or read_dht22() returns None, the main loop at rain.py:174 silently skips the DB insert with no log entry. Data gaps appear in the DB with no indication of cause. Add a logging.warning() call when sensor reads fail so failures are visible in the log.","status":"open","priority":1,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T05:15:46Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T05:15:46Z","dependencies":[{"issue_id":"rainlogger-1cw","depends_on_id":"rainlogger-3r0","type":"blocks","created_at":"2026-02-20T23:19:27Z","created_by":"umop.apisdn69","metadata":"{}"}]}
{"id":"rainlogger-1e2","title":"DS18B20Pin variable defined but never used in code","description":"DS18B20Pin = 10 at rain.py:49 is never referenced anywhere in the code. DS18B20 is read via the sysfs filesystem, not GPIO. The variable serves only as wiring documentation but looks like active code. Replace with a comment to avoid confusion.","status":"open","priority":2,"issue_type":"task","owner":"github@fsherwood.com","created_at":"2026-02-21T05:18:43Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T05:18:43Z"}
{"id":"rainlogger-20m","title":"Tips counter accessed from interrupt thread without a lock","description":"The Tips global counter is incremented in rain_interrupt() (GPIO callback thread) at rain.py:133. It is not currently read from another thread, but it is unprotected. If it is ever logged or read from the main thread, the lack of a lock is a latent race condition. Protect with a threading.Lock or use threading.local appropriately. This is related to the broader thread-safety fix for SQLite.","status":"open","priority":2,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T05:18:41Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T05:18:41Z","dependencies":[{"issue_id":"rainlogger-20m","depends_on_id":"rainlogger-q0r","type":"blocks","created_at":"2026-02-20T23:19:27Z","created_by":"umop.apisdn69","metadata":"{}"}]}
{"id":"rainlogger-21m","title":"No cleanup on unhandled exceptions in main loop","description":"Only KeyboardInterrupt is caught in the main loop. Any other exception (disk full causing SQLite write failure, GPIO error, file I/O error) will crash the program without calling GPIO.cleanup() or conn.close(). Fix: add a finally block or except Exception handler to ensure cleanup always runs.","status":"closed","priority":2,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T17:55:56Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T17:57:24Z","closed_at":"2026-02-21T17:57:24Z","close_reason":"Duplicate of rainlogger-beg which is already closed"}
{"id":"rainlogger-2ue","title":"NTP clock drift can cause timing edge case in wait loop","description":"wait_for_next_multiple_of_minutes() polls the current minute value and compares against start_minute to avoid immediate re-fire. A backward NTP clock jump could re-satisfy the condition prematurely, causing a double-fire or missed interval. Fix: use monotonic time or record the absolute target time instead of polling minute values.","status":"open","priority":4,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T18:01:15Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T18:01:15Z"}
{"id":"rainlogger-3r0","title":"DS18B20 read can hang forever with no timeout","description":"The while loop in read_ds18b20_temp() at rain.py:78 retries indefinitely if the sensor never returns YES. A broken or disconnected sensor hangs the main loop permanently, blocking all future periodic sensor writes. Add a max retry count or timeout and raise/log an error if exceeded.","status":"open","priority":1,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T05:15:47Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T05:15:47Z"}
{"id":"rainlogger-50w","title":"Mixed GPIO numbering scheme for pin variables is confusing","description":"BucketPin=12 uses BOARD numbering (because GPIO.setmode(GPIO.BOARD)) but DHT22Pin=17 uses BCM numbering (required by Adafruit_DHT). The variables look like they're in the same numbering system but are not. This is a maintenance hazard — anyone adding or changing a pin could use the wrong scheme. Document this clearly with per-variable comments or restructure to make the distinction unmistakable.","status":"open","priority":2,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T05:18:42Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T05:18:42Z"}
{"id":"rainlogger-6gj","title":"No if __name__ == '__main__' guard — daemon starts on import","description":"All setup (modprobe, GPIO init, DB connection, thread start) and the main loop run at module level. The daemon starts immediately when the file is imported, preventing any kind of unit testing or partial reuse. Move all logic into a main() function and guard with if __name__ == '__main__': main().","status":"open","priority":3,"issue_type":"task","owner":"github@fsherwood.com","created_at":"2026-02-21T05:19:01Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T05:19:01Z"}
{"id":"rainlogger-97l","title":"Restart=on-abort in systemd service too narrow","description":"on-abort only triggers restart when the process exits due to an uncaught signal (SIGSEGV, SIGABRT). A Python exception causing exit(1) or an unhandled sqlite3.OperationalError will not trigger a restart — the service just stays dead. Fix: change to Restart=on-failure to restart on any non-zero exit code.","status":"open","priority":2,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T17:57:37Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T17:57:37Z"}
{"id":"rainlogger-ady","title":"modprobe calls ignore errors silently","description":"os.system('modprobe w1-gpio') and os.system('modprobe w1-therm') at rain.py:60-61 silently succeed or fail. If the kernel modules are unavailable, subsequent DS18B20 reads fail with a confusing error rather than a clear explanation at startup. Replace with subprocess.run(['modprobe', 'w1-gpio'], check=True) so failures raise immediately with a clear message.","status":"open","priority":2,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T05:18:42Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T05:18:42Z"}
{"id":"rainlogger-beg","title":"No finally block — GPIO and DB not cleaned up on unexpected exit","description":"GPIO.cleanup() and conn.close() only run on KeyboardInterrupt. Any other unhandled exception (e.g. a DB write error) leaves GPIO dirty and the connection open. Wrap the main loop in try/finally to ensure cleanup always runs regardless of how the program exits.","status":"closed","priority":0,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T05:15:46Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T06:18:59Z","closed_at":"2026-02-21T06:18:59Z","close_reason":"Closed"}
{"id":"rainlogger-brn","title":"No index on timestamp column in WeatherEvents table","description":"WeatherEvents has no primary key and no index on c_mod (the timestamp column). Time-range queries used by reporting scripts will do full table scans as the DB grows over months/years. Add: CREATE INDEX IF NOT EXISTS idx_mod ON WeatherEvents(c_mod) to the table setup.","status":"open","priority":3,"issue_type":"task","owner":"github@fsherwood.com","created_at":"2026-02-21T05:19:00Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T05:19:00Z"}
{"id":"rainlogger-ce3","title":"SQL injection via f-string interpolation in ws.py","description":"start_date and end_date values come directly from sys.argv and are interpolated into SQL queries using f-strings without parameterization. While currently a local script, this is a real SQL injection vulnerability if the script is ever wrapped in a web interface or called by another program. Fix: use parameterized queries with ? placeholders.","status":"open","priority":2,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T17:55:36Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T17:55:36Z"}
{"id":"rainlogger-dtp","title":"Log file grows unboundedly — no rotation configured","description":"The daemon uses logging.FileHandler which never rotates. Over weeks or months of continuous operation the log file will grow without bound. Replace with RotatingFileHandler or TimedRotatingFileHandler to cap log size.","status":"open","priority":1,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T05:15:44Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T05:15:44Z"}
{"id":"rainlogger-e6u","title":"Commented-out pull-up resistor on bucket pin unexplained","description":"GPIO.setup(BucketPin, GPIO.IN, pull_up_down=GPIO.PUD_UP) is commented out at rain.py:119 with no explanation. If the hardware has an external pull-up or pull-down resistor this is intentional, but a floating input can cause spurious rain tip events. Add a comment explaining why the pull-up is disabled.","status":"open","priority":3,"issue_type":"task","owner":"github@fsherwood.com","created_at":"2026-02-21T05:19:00Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T05:19:00Z"}
{"id":"rainlogger-em9","title":"No date input validation in ws.py","description":"Command-line date arguments are passed directly without format validation. Invalid input like 'abc' produces confusing empty results rather than a helpful error message. Fix: validate that arguments match YYYY-MM-DD format before proceeding, and print a clear usage error if they don't.","status":"open","priority":4,"issue_type":"task","owner":"github@fsherwood.com","created_at":"2026-02-21T18:00:36Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T18:00:36Z"}
{"id":"rainlogger-g29","title":"Missing RestartSec delay in systemd service","description":"No RestartSec is set, so systemd restarts the service at the default 100ms interval. If the service enters a crash loop (e.g. sensor disconnected), this can thrash the system. Fix: add RestartSec with a short delay (e.g. 5 seconds) to avoid rapid restart loops while still recovering quickly from transient failures.","status":"open","priority":3,"issue_type":"task","owner":"github@fsherwood.com","created_at":"2026-02-21T17:58:44Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T17:58:44Z"}
{"id":"rainlogger-jrt","title":"Log file named rain6.log — looks manually versioned","description":"The log file is hardcoded as rain6.log at rain.py:123. The '6' appears to be a vestigial manual version number. Rename to rain.log or a name that reflects purpose rather than version.","status":"open","priority":4,"issue_type":"task","owner":"github@fsherwood.com","created_at":"2026-02-21T05:19:02Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T05:19:02Z"}
{"id":"rainlogger-q0r","title":"Thread-unsafe SQLite access from rain interrupt and main loop","description":"rain_interrupt() runs in GPIO's callback thread and shares the module-level conn/c objects with the main loop. check_same_thread=False permits this but does not make it safe — concurrent writes from two threads without locking can corrupt the database. Fix: add threading.Lock() around every c.execute()/conn.commit() pair in both rain_interrupt() and the main loop, or give each thread its own connection.","status":"closed","priority":0,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T05:15:45Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T06:18:59Z","closed_at":"2026-02-21T06:18:59Z","close_reason":"Closed"}
{"id":"rainlogger-zpx","title":"read_ds18b20_temp() silently returns None when t= marker missing","description":"If equals_pos == -1 (the t= marker is absent from sensor output), the function falls through and returns None implicitly with no log warning. Combined with the partial sensor failure issue, this silently drops the entire reading with no indication of what went wrong. Fix: add explicit return None with a logged warning when equals_pos == -1.","status":"open","priority":2,"issue_type":"bug","owner":"github@fsherwood.com","created_at":"2026-02-21T17:55:01Z","created_by":"umop.apisdn69","updated_at":"2026-02-21T17:55:01Z"}
